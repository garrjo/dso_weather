<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSO Weather</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-card: #252542;
            --bg-card-hover: #2d2d52;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b8;
            --text-dim: #6c6c8a;
            --accent-yellow: #ffd02e;
            --accent-blue: #4a9eff;
            --accent-green: #2ed573;
            --accent-orange: #ff8c42;
            --accent-red: #ff4757;
            --accent-purple: #a55eea;
            --border: rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] {
            --bg-primary: #f0f2f5;
            --bg-card: #ffffff;
            --bg-card-hover: #f5f5f5;
            --text-primary: #1a1a2e;
            --text-secondary: #4b5563;
            --text-dim: #9ca3af;
            --border: rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .location-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .location-name {
            font-size: 24px;
            font-weight: 600;
        }

        .location-select {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 14px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover { background: var(--bg-card-hover); }

        .unit-toggle {
            display: flex;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .unit-toggle button {
            padding: 8px 14px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 600;
        }

        .unit-toggle button.active {
            background: var(--accent-blue);
            color: white;
        }

        /* Main Hero */
        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .current-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
        }

        .weather-main {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 16px;
        }

        .weather-icon { font-size: 80px; line-height: 1; }

        .temp-display {
            font-size: 72px;
            font-weight: 300;
            line-height: 1;
        }

        .temp-display .unit {
            font-size: 32px;
            color: var(--text-secondary);
            vertical-align: top;
        }

        .condition { font-size: 20px; margin: 8px 0 4px; }
        .feels-like { font-size: 14px; color: var(--text-secondary); }

        .high-low {
            display: flex;
            gap: 16px;
            margin-top: 8px;
            font-size: 16px;
        }

        .high-low .high { color: var(--accent-orange); }
        .high-low .low { color: var(--accent-blue); }

        .update-time {
            font-size: 12px;
            color: var(--text-dim);
            margin-top: 16px;
        }

        /* DSO Risk Panel */
        .dso-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
        }

        .panel-title {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .risk-display {
            text-align: center;
            padding: 16px 0;
        }

        .risk-value {
            font-size: 56px;
            font-weight: 700;
        }

        .risk-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .risk-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
        }

        .risk-minimal { background: var(--accent-blue); }
        .risk-low { background: var(--accent-green); }
        .risk-moderate { background: var(--accent-orange); }
        .risk-high { background: var(--accent-red); }

        .dso-factors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .factor-box {
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .factor-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--accent-yellow);
        }

        .factor-label {
            font-size: 11px;
            color: var(--text-dim);
            margin-top: 4px;
        }

        /* Detail Cards Grid */
        .details-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .detail-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            min-height: 180px;
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .card-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .card-value {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .card-value .unit {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .card-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-good { background: var(--accent-green); }
        .status-moderate { background: var(--accent-orange); }
        .status-poor { background: var(--accent-red); }

        .card-desc {
            font-size: 12px;
            color: var(--text-dim);
            line-height: 1.4;
        }

        /* Mini Charts */
        .mini-chart {
            height: 40px;
            margin: 8px 0;
            position: relative;
        }

        .mini-chart svg {
            width: 100%;
            height: 100%;
        }

        /* Wind Compass */
        .wind-display {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .compass {
            width: 70px;
            height: 70px;
            border: 2px solid var(--border);
            border-radius: 50%;
            position: relative;
        }

        .compass-labels {
            position: absolute;
            width: 100%;
            height: 100%;
            font-size: 10px;
            color: var(--text-dim);
        }

        .compass-n { position: absolute; top: 4px; left: 50%; transform: translateX(-50%); }
        .compass-s { position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); }
        .compass-e { position: absolute; right: 4px; top: 50%; transform: translateY(-50%); }
        .compass-w { position: absolute; left: 4px; top: 50%; transform: translateY(-50%); }

        .compass-arrow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 28px;
            background: var(--accent-blue);
            border-radius: 2px;
            transform-origin: bottom center;
        }

        .wind-info { flex: 1; }

        .wind-dir {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .wind-speeds {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 14px;
        }

        .wind-speeds span { color: var(--text-dim); font-size: 12px; }

        /* Humidity Bars */
        .humidity-bars {
            display: flex;
            gap: 3px;
            height: 50px;
            align-items: flex-end;
            margin: 12px 0;
        }

        .h-bar {
            flex: 1;
            background: var(--accent-blue);
            border-radius: 2px;
            min-height: 4px;
        }

        /* UV Gauge */
        .uv-gauge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 6px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 8px auto;
            position: relative;
        }

        .uv-gauge::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border-radius: 50%;
            border: 6px solid transparent;
            border-top-color: var(--accent-green);
            transform: rotate(-45deg);
        }

        .uv-value {
            font-size: 28px;
            font-weight: 600;
        }

        /* Pressure Graph */
        .pressure-graph {
            height: 50px;
            margin: 8px 0;
            position: relative;
        }

        .pressure-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue), var(--accent-green), var(--accent-yellow), var(--accent-orange), var(--accent-red));
            border-radius: 2px;
        }

        .pressure-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--accent-blue);
            border: 2px solid white;
            border-radius: 50%;
            bottom: -4px;
            transform: translateX(-50%);
        }

        /* Sun Arc */
        .sun-arc {
            height: 60px;
            position: relative;
            margin: 8px 0;
        }

        .sun-arc svg {
            width: 100%;
            height: 100%;
        }

        .sun-times {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-top: 8px;
        }

        .sun-times .label {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* Hourly Forecast */
        .hourly-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
        }

        .scroll-btns {
            display: flex;
            gap: 8px;
        }

        .scroll-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 18px;
        }

        .hourly-scroll {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .hourly-scroll::-webkit-scrollbar { height: 4px; }
        .hourly-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

        .hour-item {
            flex: 0 0 70px;
            text-align: center;
            padding: 12px 8px;
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
        }

        .hour-item.now { background: rgba(74, 158, 255, 0.2); }

        .hour-time { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
        .hour-icon { font-size: 28px; margin: 8px 0; }
        .hour-temp { font-size: 16px; font-weight: 600; }
        .hour-precip { font-size: 11px; color: var(--accent-blue); margin-top: 4px; }

        /* Daily Forecast */
        .daily-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .daily-list { display: flex; flex-direction: column; }

        .daily-item {
            display: grid;
            grid-template-columns: 100px 50px 1fr 100px 50px;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
            gap: 12px;
        }

        .daily-item:last-child { border-bottom: none; }

        .daily-day { font-size: 15px; font-weight: 500; }
        .daily-icon { font-size: 28px; text-align: center; }
        .daily-condition { font-size: 13px; color: var(--text-secondary); }

        .daily-temps {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .daily-low { font-size: 14px; color: var(--text-secondary); min-width: 35px; }
        .daily-high { font-size: 14px; font-weight: 600; min-width: 35px; text-align: right; }

        .temp-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            position: relative;
            min-width: 80px;
        }

        .temp-bar-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-orange));
            border-radius: 3px;
        }

        .daily-precip {
            font-size: 13px;
            color: var(--accent-blue);
            text-align: right;
        }

        /* Monthly Calendar */
        .monthly-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .month-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .month-tab {
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
        }

        .month-tab.active {
            background: var(--accent-blue);
            color: white;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-header {
            text-align: center;
            font-size: 12px;
            color: var(--text-dim);
            padding: 8px;
        }

        .calendar-day {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            min-height: 80px;
        }

        .calendar-day.today {
            border: 2px solid var(--accent-blue);
        }

        .calendar-day.other-month {
            opacity: 0.4;
        }

        .cal-date { font-size: 12px; color: var(--text-dim); margin-bottom: 4px; }
        .cal-icon { font-size: 24px; margin: 4px 0; }
        .cal-temps { font-size: 12px; }
        .cal-high { color: var(--accent-orange); }
        .cal-low { color: var(--text-secondary); }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-dim);
            font-size: 12px;
        }

        .data-sources {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 8px;
        }

        .source-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .source-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-green);
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-icon { font-size: 48px; margin-bottom: 16px; }
        .loading-text { font-size: 18px; }

        .loading-bar {
            width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }

        .loading-bar-fill {
            height: 100%;
            width: 30%;
            background: var(--accent-blue);
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(250%); }
            100% { transform: translateX(-100%); }
        }

        .skip-btn {
            margin-top: 20px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .details-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 900px) {
            .hero-section { grid-template-columns: 1fr; }
            .details-grid { grid-template-columns: repeat(2, 1fr); }
            .daily-item { grid-template-columns: 80px 40px 1fr 80px; }
            .daily-condition { display: none; }
        }

        @media (max-width: 600px) {
            .details-grid { grid-template-columns: 1fr 1fr; }
            .calendar-grid { gap: 4px; }
            .calendar-day { min-height: 60px; padding: 4px; }
            .daily-item { grid-template-columns: 60px 32px 1fr; }
            .daily-temps { display: none; }
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-icon">üå§Ô∏è</div>
        <div class="loading-text">Detecting Location...</div>
        <div class="loading-bar"><div class="loading-bar-fill"></div></div>
        <button class="skip-btn" onclick="skipDetection()">Skip - Use Default</button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="location-section">
                <div class="location-name" id="locationName">Little Rock, AR</div>
                <select class="location-select" id="locationSelect" onchange="changeLocation()">
                    <option value="auto">Use My Location</option>
                    <option value="34.746,-92.290|Little Rock, AR">Little Rock, AR</option>
                    <option value="35.492,-97.503|Oklahoma City, OK">Oklahoma City, OK</option>
                    <option value="32.777,-96.797|Dallas, TX">Dallas, TX</option>
                    <option value="33.749,-84.388|Atlanta, GA">Atlanta, GA</option>
                    <option value="36.166,-86.784|Nashville, TN">Nashville, TN</option>
                    <option value="41.878,-87.630|Chicago, IL">Chicago, IL</option>
                    <option value="39.739,-104.990|Denver, CO">Denver, CO</option>
                    <option value="40.713,-74.006|New York, NY">New York, NY</option>
                    <option value="34.052,-118.244|Los Angeles, CA">Los Angeles, CA</option>
                    <option value="25.762,-80.192|Miami, FL">Miami, FL</option>
                </select>
            </div>
            <div class="header-actions">
                <div class="unit-toggle">
                    <button id="unitF" class="active" onclick="setUnit('F')">¬∞F</button>
                    <button id="unitC" onclick="setUnit('C')">¬∞C</button>
                </div>
                <button class="btn" id="themeBtn" onclick="toggleTheme()">‚òÄÔ∏è</button>
                <button class="btn" onclick="refreshData()">‚Üª</button>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="current-card">
                <div class="weather-main">
                    <div class="weather-icon" id="weatherIcon">üå§Ô∏è</div>
                    <div>
                        <div class="temp-display"><span id="currentTemp">--</span><span class="unit">¬∞</span></div>
                        <div class="condition" id="conditionText">Loading...</div>
                        <div class="feels-like">Feels like <span id="feelsLike">--</span>¬∞</div>
                        <div class="high-low">
                            <span class="high">H: <span id="todayHigh">--</span>¬∞</span>
                            <span class="low">L: <span id="todayLow">--</span>¬∞</span>
                        </div>
                    </div>
                </div>
                <div class="update-time">Updated <span id="updateTime">--</span></div>
            </div>

            <div class="dso-card">
                <div class="panel-title">Severe Weather Risk</div>
                <div class="risk-display">
                    <div class="risk-value" id="riskValue" style="color: var(--accent-blue);">MINIMAL</div>
                    <div class="risk-label" id="riskLabel">Low threat for severe weather</div>
                    <span class="risk-badge risk-minimal" id="riskBadge">MINIMAL</span>
                </div>
                <div class="dso-factors">
                    <div class="factor-box">
                        <div class="factor-value" id="factorP">--</div>
                        <div class="factor-label">Probability</div>
                    </div>
                    <div class="factor-box">
                        <div class="factor-value" id="factorV">--</div>
                        <div class="factor-label">Volatility</div>
                    </div>
                    <div class="factor-box">
                        <div class="factor-value" id="factorD">--</div>
                        <div class="factor-label">Danger Index</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Detail Cards -->
        <section class="details-grid" id="detailsGrid">
            <!-- Temperature -->
            <div class="detail-card">
                <div class="card-title">Temperature</div>
                <div class="card-main">
                    <div class="mini-chart" id="tempChart"></div>
                    <div class="card-value"><span id="tempCard">--</span><span class="unit">¬∞</span></div>
                    <div class="card-status">
                        <span class="status-dot status-good" id="tempDot"></span>
                        <span id="tempStatus">Steady</span>
                    </div>
                    <div class="card-desc" id="tempDesc">--</div>
                </div>
            </div>

            <!-- Feels Like -->
            <div class="detail-card">
                <div class="card-title">Feels like</div>
                <div class="card-main">
                    <div class="mini-chart" id="feelsChart"></div>
                    <div style="display: flex; gap: 16px; align-items: baseline;">
                        <div><span style="color: var(--text-dim); font-size: 12px;">Feels:</span> <span id="feelsCard" style="font-size: 24px; font-weight: 600;">--</span>¬∞</div>
                        <div><span style="color: var(--text-dim); font-size: 12px;">Actual:</span> <span id="actualCard">--</span>¬∞</div>
                    </div>
                    <div class="card-status">
                        <span class="status-dot" id="feelsDot"></span>
                        <span id="feelsStatus">--</span>
                    </div>
                    <div class="card-desc" id="feelsDesc">--</div>
                </div>
            </div>

            <!-- Cloud Cover -->
            <div class="detail-card">
                <div class="card-title">Cloud cover</div>
                <div class="card-main" style="text-align: center;">
                    <div style="font-size: 48px; margin: 8px 0;" id="cloudIcon">‚õÖ</div>
                    <div class="card-status" style="justify-content: center;">
                        <span id="cloudText">Partly Cloudy</span>
                        <span style="color: var(--text-dim);">(<span id="cloudPct">50</span>%)</span>
                    </div>
                    <div class="card-desc" id="cloudDesc">--</div>
                </div>
            </div>

            <!-- Precipitation -->
            <div class="detail-card">
                <div class="card-title">Precipitation</div>
                <div class="card-main" style="text-align: center;">
                    <div style="font-size: 36px; font-weight: 300; margin: 12px 0;"><span id="precipAmt">0</span> <span style="font-size: 16px; color: var(--text-secondary);">in</span></div>
                    <div style="font-size: 12px; color: var(--text-dim);">In next 24h</div>
                    <div class="card-status" style="justify-content: center; margin-top: 12px;">
                        <span class="status-dot status-good" id="precipDot"></span>
                        <span id="precipStatus">No Precipitation</span>
                    </div>
                    <div class="card-desc" id="precipDesc">--</div>
                </div>
            </div>

            <!-- Wind -->
            <div class="detail-card">
                <div class="card-title">Wind</div>
                <div class="card-main">
                    <div class="wind-display">
                        <div class="compass">
                            <div class="compass-labels">
                                <span class="compass-n">N</span>
                                <span class="compass-s">S</span>
                                <span class="compass-e">E</span>
                                <span class="compass-w">W</span>
                            </div>
                            <div class="compass-arrow" id="windArrow" style="transform: translate(-50%, -100%) rotate(0deg);"></div>
                        </div>
                        <div class="wind-info">
                            <div class="wind-dir">From <span id="windDir">N</span> (<span id="windDeg">0</span>¬∞)</div>
                            <div class="wind-speeds">
                                <div><strong id="windSpeed">--</strong> <span>mph Wind</span></div>
                                <div><strong id="windGust">--</strong> <span>mph Gust</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-status" style="margin-top: 12px;">
                        <span class="status-dot status-good" id="windDot"></span>
                        <span id="windStatus">Light Air</span>
                    </div>
                    <div class="card-desc" id="windDesc">--</div>
                </div>
            </div>

            <!-- Humidity -->
            <div class="detail-card">
                <div class="card-title">Humidity</div>
                <div class="card-main">
                    <div class="humidity-bars" id="humidityBars"></div>
                    <div style="display: flex; justify-content: space-between; align-items: baseline;">
                        <div><span id="humidity" style="font-size: 28px; font-weight: 600;">--</span><span class="unit">%</span><br><span style="font-size: 11px; color: var(--text-dim);">Humidity</span></div>
                        <div style="text-align: right;"><span id="dewpoint" style="font-size: 20px;">--</span>¬∞<br><span style="font-size: 11px; color: var(--text-dim);">Dew point</span></div>
                    </div>
                    <div class="card-status">
                        <span class="status-dot" id="humidityDot"></span>
                        <span id="humidityStatus">Normal</span>
                    </div>
                    <div class="card-desc" id="humidityDesc">--</div>
                </div>
            </div>

            <!-- UV -->
            <div class="detail-card">
                <div class="card-title">UV</div>
                <div class="card-main" style="text-align: center;">
                    <div class="uv-gauge" id="uvGauge">
                        <div class="uv-value" id="uvIndex">--</div>
                    </div>
                    <div class="card-status" style="justify-content: center;">
                        <span class="status-dot status-good" id="uvDot"></span>
                        <span id="uvStatus">Low</span>
                    </div>
                    <div class="card-desc" id="uvDesc">--</div>
                </div>
            </div>

            <!-- Pressure -->
            <div class="detail-card">
                <div class="card-title">Pressure</div>
                <div class="card-main">
                    <div class="pressure-graph">
                        <div class="pressure-line"></div>
                        <div class="pressure-dot" id="pressureDot" style="left: 50%;"></div>
                    </div>
                    <div class="card-value"><span id="pressure">--</span> <span class="unit">in</span></div>
                    <div class="card-status">
                        <span class="status-dot status-good" id="pressureStatusDot"></span>
                        <span id="pressureStatus">Rising</span>
                    </div>
                    <div class="card-desc" id="pressureDesc">--</div>
                </div>
            </div>

            <!-- Visibility -->
            <div class="detail-card">
                <div class="card-title">Visibility</div>
                <div class="card-main">
                    <div style="display: flex; gap: 4px; margin: 12px 0;">
                        <div style="flex: 1; height: 8px; background: var(--accent-green); border-radius: 4px;"></div>
                        <div style="flex: 1; height: 8px; background: var(--accent-green); border-radius: 4px;"></div>
                        <div style="flex: 1; height: 8px; background: var(--accent-green); border-radius: 4px;"></div>
                        <div style="flex: 1; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;" id="visBar4"></div>
                    </div>
                    <div class="card-value"><span id="visibility">--</span> <span class="unit">mi</span></div>
                    <div class="card-status">
                        <span class="status-dot status-good" id="visDot"></span>
                        <span id="visStatus">Excellent</span>
                    </div>
                    <div class="card-desc" id="visDesc">--</div>
                </div>
            </div>

            <!-- Sun -->
            <div class="detail-card">
                <div class="card-title">Sun</div>
                <div class="card-main">
                    <div class="sun-arc">
                        <svg viewBox="0 0 200 70">
                            <defs>
                                <linearGradient id="sunGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#ffd02e"/>
                                    <stop offset="50%" style="stop-color:#ff8c42"/>
                                    <stop offset="100%" style="stop-color:#a55eea"/>
                                </linearGradient>
                            </defs>
                            <path d="M 10 60 Q 100 -20 190 60" stroke="url(#sunGrad)" stroke-width="4" fill="none"/>
                            <circle id="sunPosition" cx="100" cy="20" r="8" fill="#ffd02e"/>
                        </svg>
                    </div>
                    <div style="text-align: center; font-size: 13px; color: var(--text-dim); margin-bottom: 8px;"><span id="dayLength">-- hrs -- mins</span></div>
                    <div class="sun-times">
                        <div><strong id="sunrise">--</strong><div class="label">Sunrise</div></div>
                        <div style="text-align: right;"><strong id="sunset">--</strong><div class="label">Sunset</div></div>
                    </div>
                </div>
            </div>

            <!-- Moon -->
            <div class="detail-card">
                <div class="card-title">Moon</div>
                <div class="card-main">
                    <div class="sun-arc">
                        <svg viewBox="0 0 200 70">
                            <path d="M 10 60 Q 100 -20 190 60" stroke="#6c6c8a" stroke-width="4" fill="none" stroke-dasharray="5,5"/>
                            <circle id="moonPosition" cx="100" cy="20" r="8" fill="#c4a35a"/>
                        </svg>
                    </div>
                    <div style="text-align: center; font-size: 13px; color: var(--text-dim); margin-bottom: 8px;"><span id="moonLength">-- hrs -- mins</span></div>
                    <div class="sun-times">
                        <div><strong id="moonrise">--</strong><div class="label">Moonrise</div></div>
                        <div style="text-align: right;"><strong id="moonset">--</strong><div class="label">Moonset</div></div>
                    </div>
                </div>
            </div>

            <!-- Moon Phase -->
            <div class="detail-card">
                <div class="card-title">Moon phase</div>
                <div class="card-main" style="text-align: center;">
                    <div style="font-size: 48px; margin: 8px 0;" id="moonIcon">üåì</div>
                    <div class="card-value"><span id="moonPhase">45</span><span class="unit">%</span></div>
                    <div style="font-size: 12px; color: var(--text-dim);">Phase of moon</div>
                    <div style="margin-top: 8px; font-size: 13px;"><span style="color: var(--accent-yellow);">‚óè</span> Next full moon <strong id="nextFull">--</strong></div>
                </div>
            </div>
        </section>

        <!-- Hourly -->
        <section class="hourly-section">
            <div class="section-header">
                <span class="section-title">Hourly Forecast</span>
                <div class="scroll-btns">
                    <button class="scroll-btn" onclick="scrollHourly(-1)">‚Äπ</button>
                    <button class="scroll-btn" onclick="scrollHourly(1)">‚Ä∫</button>
                </div>
            </div>
            <div class="hourly-scroll" id="hourlyScroll"></div>
        </section>

        <!-- Daily -->
        <section class="daily-section">
            <div class="section-header">
                <span class="section-title">10-Day Forecast</span>
            </div>
            <div class="daily-list" id="dailyList"></div>
        </section>

        <!-- Monthly Calendar -->
        <section class="monthly-section">
            <div class="section-header">
                <span class="section-title">Monthly</span>
            </div>
            <div class="month-tabs" id="monthTabs"></div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div>Powered by DSO Weather Engine</div>
            <div class="data-sources">
                <div class="source-item"><span class="source-dot"></span> NWS</div>
                <div class="source-item"><span class="source-dot"></span> Open-Meteo</div>
            </div>
        </footer>
    </div>

    <script src="noaaWeatherService.js"></script>
    <script>
        // State
        let currentLocation = { lat: 34.7465, lon: -92.2896, name: 'Little Rock, AR' };
        let currentUnit = 'F';
        let weatherData = null;
        let currentMonth = new Date().getMonth();

        // DSO Engine
        class DSOEngine {
            getDayOfYear(date = new Date()) {
                const start = new Date(date.getFullYear(), 0, 0);
                return Math.floor((date - start) / 86400000);
            }

            getCatalyst(doy) {
                return Math.abs(Math.cos((2 * Math.PI * (doy - 80)) / 365.25));
            }

            getSolar(lat, doy) {
                const latRad = lat * Math.PI / 180;
                const dec = 23.44 * Math.sin((2 * Math.PI * (doy - 81)) / 365.25) * Math.PI / 180;
                return Math.max(0, Math.sin(Math.asin(Math.sin(latRad) * Math.sin(dec) + Math.cos(latRad) * Math.cos(dec))));
            }

            getFuel(lat) {
                const d = Math.abs(lat - 25);
                return d < 5 ? 0.95 : d < 15 ? 0.85 : d < 30 ? 0.60 : 0.30;
            }

            getGradient(lat) {
                return (lat >= 33 && lat <= 38) ? 0.95 : (lat >= 30 && lat < 33) ? 0.80 : 0.60;
            }

            calculate(lat, doy) {
                const cat = this.getCatalyst(doy);
                const sol = this.getSolar(lat, doy);
                const fuel = this.getFuel(lat);
                const grad = this.getGradient(lat);
                const P = fuel * grad * cat;
                const V = cat * sol;
                const D = P * V;

                let level = 'MINIMAL', color = 'var(--accent-blue)', badge = 'risk-minimal';
                if (D > 0.5) { level = 'EXTREME'; color = 'var(--accent-red)'; badge = 'risk-high'; }
                else if (D > 0.3) { level = 'HIGH'; color = 'var(--accent-orange)'; badge = 'risk-high'; }
                else if (D > 0.15) { level = 'MODERATE'; color = 'var(--accent-yellow)'; badge = 'risk-moderate'; }
                else if (D > 0.05) { level = 'LOW'; color = 'var(--accent-green)'; badge = 'risk-low'; }

                return { P, V, D, level, color, badge };
            }
        }

        const dso = new DSOEngine();

        // Icon helper
        function getIcon(c, day = true) {
            c = (c || '').toLowerCase();
            if (c.includes('thunder') || c.includes('storm')) return '‚õàÔ∏è';
            if (c.includes('rain') || c.includes('shower')) return 'üåßÔ∏è';
            if (c.includes('snow')) return '‚ùÑÔ∏è';
            if (c.includes('fog')) return 'üå´Ô∏è';
            if (c.includes('cloud') || c.includes('overcast')) return day ? '‚õÖ' : '‚òÅÔ∏è';
            if (c.includes('partly')) return day ? 'üå§Ô∏è' : '‚òÅÔ∏è';
            return day ? '‚òÄÔ∏è' : 'üåô';
        }

        // Convert temp
        function toUnit(f) {
            return currentUnit === 'F' ? Math.round(f) : Math.round((f - 32) * 5/9);
        }

        // Update UI
        function updateCurrent(d) {
            if (!d) return;
            document.getElementById('currentTemp').textContent = toUnit(d.tempF);
            document.getElementById('feelsLike').textContent = toUnit(d.feelsLikeF || d.tempF);
            document.getElementById('conditionText').textContent = d.condition || 'Unknown';
            document.getElementById('weatherIcon').textContent = getIcon(d.condition);
            document.getElementById('updateTime').textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            // Detail cards
            document.getElementById('tempCard').textContent = toUnit(d.tempF);
            document.getElementById('feelsCard').textContent = toUnit(d.feelsLikeF || d.tempF);
            document.getElementById('actualCard').textContent = toUnit(d.tempF);
            document.getElementById('humidity').textContent = d.humidity || '--';
            document.getElementById('dewpoint').textContent = d.dewpoint || '--';
            document.getElementById('windSpeed').textContent = d.windSpeed || '--';
            document.getElementById('windGust').textContent = d.windGust || d.windSpeed || '--';
            document.getElementById('windDir').textContent = d.windDirection || 'N';
            document.getElementById('windDeg').textContent = d.windDegrees || 0;
            document.getElementById('pressure').textContent = d.pressure ? (d.pressure / 33.864).toFixed(2) : '--';
            document.getElementById('visibility').textContent = d.visibility || '--';
            document.getElementById('uvIndex').textContent = d.uvIndex || '--';
            document.getElementById('cloudPct').textContent = d.cloudCover || 50;

            // Humidity bars
            const hBars = document.getElementById('humidityBars');
            const h = d.humidity || 50;
            hBars.innerHTML = Array(10).fill(0).map((_, i) =>
                `<div class="h-bar" style="height: ${(i < h/10 ? 100 : 20)}%;"></div>`
            ).join('');

            // Wind arrow
            const deg = d.windDegrees || 0;
            document.getElementById('windArrow').style.transform = `translate(-50%, -100%) rotate(${deg + 180}deg)`;

            // Status updates
            updateStatuses(d);
        }

        function updateStatuses(d) {
            const h = d.humidity || 50;
            document.getElementById('humidityStatus').textContent = h > 70 ? 'High' : h < 30 ? 'Low' : 'Normal';
            document.getElementById('humidityDot').className = 'status-dot ' + (h > 80 || h < 20 ? 'status-poor' : h > 60 ? 'status-moderate' : 'status-good');

            const ws = d.windSpeed || 0;
            document.getElementById('windStatus').textContent = ws < 4 ? 'Calm' : ws < 12 ? 'Light' : ws < 25 ? 'Moderate' : 'Strong';
            document.getElementById('windDot').className = 'status-dot ' + (ws > 30 ? 'status-poor' : ws > 15 ? 'status-moderate' : 'status-good');

            const uv = d.uvIndex || 0;
            document.getElementById('uvStatus').textContent = uv <= 2 ? 'Low' : uv <= 5 ? 'Moderate' : uv <= 7 ? 'High' : 'Very High';
            document.getElementById('uvDot').className = 'status-dot ' + (uv > 7 ? 'status-poor' : uv > 5 ? 'status-moderate' : 'status-good');
        }

        function updateDSO() {
            const r = dso.calculate(currentLocation.lat, dso.getDayOfYear());
            document.getElementById('riskValue').textContent = r.level;
            document.getElementById('riskValue').style.color = r.color;
            document.getElementById('riskBadge').textContent = r.level;
            document.getElementById('riskBadge').className = 'risk-badge ' + r.badge;
            document.getElementById('riskLabel').textContent = {
                'MINIMAL': 'Low threat for severe weather',
                'LOW': 'Isolated storms possible',
                'MODERATE': 'Scattered severe storms possible',
                'HIGH': 'Widespread severe weather likely',
                'EXTREME': 'Dangerous weather outbreak'
            }[r.level];
            document.getElementById('factorP').textContent = r.P.toFixed(2);
            document.getElementById('factorV').textContent = r.V.toFixed(2);
            document.getElementById('factorD').textContent = r.D.toFixed(2);
        }

        function updateHourly(hrs) {
            const c = document.getElementById('hourlyScroll');
            if (!hrs?.length) { c.innerHTML = '<div style="padding:20px;color:var(--text-dim)">No data</div>'; return; }
            c.innerHTML = hrs.slice(0, 24).map((h, i) => {
                const hr = new Date(h.time);
                const isDay = hr.getHours() >= 6 && hr.getHours() < 20;
                return `<div class="hour-item ${i === 0 ? 'now' : ''}">
                    <div class="hour-time">${i === 0 ? 'Now' : hr.toLocaleTimeString([], {hour: 'numeric'})}</div>
                    <div class="hour-icon">${getIcon(h.condition, isDay)}</div>
                    <div class="hour-temp">${toUnit(h.tempF)}¬∞</div>
                    ${h.precipProb > 0 ? `<div class="hour-precip">${h.precipProb}%</div>` : ''}
                </div>`;
            }).join('');
        }

        function updateDaily(days) {
            const c = document.getElementById('dailyList');
            if (!days?.length) { c.innerHTML = '<div style="padding:20px;color:var(--text-dim)">No data</div>'; return; }

            let min = Infinity, max = -Infinity;
            days.forEach(d => { if (d.lowF < min) min = d.lowF; if (d.highF > max) max = d.highF; });
            const range = max - min || 1;

            document.getElementById('todayHigh').textContent = toUnit(days[0]?.highF);
            document.getElementById('todayLow').textContent = toUnit(days[0]?.lowF);

            c.innerHTML = days.slice(0, 10).map((d, i) => {
                const dt = new Date(d.date);
                const name = i === 0 ? 'Today' : i === 1 ? 'Tomorrow' : dt.toLocaleDateString('en-US', {weekday: 'short'});
                const left = ((d.lowF - min) / range) * 100;
                const width = ((d.highF - d.lowF) / range) * 100;
                return `<div class="daily-item">
                    <div class="daily-day">${name}</div>
                    <div class="daily-icon">${getIcon(d.condition)}</div>
                    <div class="daily-condition">${d.condition || '--'}</div>
                    <div class="daily-temps">
                        <span class="daily-low">${toUnit(d.lowF)}¬∞</span>
                        <div class="temp-bar"><div class="temp-bar-fill" style="left:${left}%;width:${width}%"></div></div>
                        <span class="daily-high">${toUnit(d.highF)}¬∞</span>
                    </div>
                    <div class="daily-precip">${d.precipProb > 0 ? d.precipProb + '%' : ''}</div>
                </div>`;
            }).join('');
        }

        function updateCalendar() {
            const tabs = document.getElementById('monthTabs');
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const year = new Date().getFullYear();

            tabs.innerHTML = months.map((m, i) =>
                `<button class="month-tab ${i === currentMonth ? 'active' : ''}" onclick="setMonth(${i})">${i === new Date().getMonth() ? '<small>' + year + '</small><br>' : ''}${m}</button>`
            ).join('');

            const grid = document.getElementById('calendarGrid');
            const firstDay = new Date(year, currentMonth, 1).getDay();
            const daysInMonth = new Date(year, currentMonth + 1, 0).getDate();
            const today = new Date();

            let html = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => `<div class="calendar-header">${d}</div>`).join('');

            // Previous month days
            const prevMonthDays = new Date(year, currentMonth, 0).getDate();
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = prevMonthDays - i;
                html += `<div class="calendar-day other-month"><div class="cal-date">${day}</div><div class="cal-icon">‚òÄÔ∏è</div><div class="cal-temps"><span class="cal-high">--¬∞</span> <span class="cal-low">--¬∞</span></div></div>`;
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = today.getDate() === day && today.getMonth() === currentMonth;
                html += `<div class="calendar-day ${isToday ? 'today' : ''}">
                    <div class="cal-date">${day}</div>
                    <div class="cal-icon">${['‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', 'üåßÔ∏è', '‚õàÔ∏è'][Math.floor(Math.random() * 5)]}</div>
                    <div class="cal-temps"><span class="cal-high">${40 + Math.floor(Math.random() * 30)}¬∞</span> <span class="cal-low">${20 + Math.floor(Math.random() * 20)}¬∞</span></div>
                </div>`;
            }

            // Next month days
            const totalCells = firstDay + daysInMonth;
            const remaining = 7 - (totalCells % 7);
            if (remaining < 7) {
                for (let i = 1; i <= remaining; i++) {
                    html += `<div class="calendar-day other-month"><div class="cal-date">${i}</div><div class="cal-icon">‚òÄÔ∏è</div><div class="cal-temps"><span class="cal-high">--¬∞</span> <span class="cal-low">--¬∞</span></div></div>`;
                }
            }

            grid.innerHTML = html;
        }

        function setMonth(m) {
            currentMonth = m;
            updateCalendar();
        }

        // Fetch data
        async function fetchData() {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${currentLocation.lat}&longitude=${currentLocation.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,wind_direction_10m,surface_pressure,cloud_cover&hourly=temperature_2m,weather_code,precipitation_probability&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=auto`;
                const res = await fetch(url);
                const data = await res.json();

                const current = {
                    tempF: Math.round(data.current.temperature_2m),
                    feelsLikeF: Math.round(data.current.apparent_temperature),
                    humidity: data.current.relative_humidity_2m,
                    windSpeed: Math.round(data.current.wind_speed_10m),
                    windDegrees: data.current.wind_direction_10m,
                    windDirection: ['N','NE','E','SE','S','SW','W','NW'][Math.round(data.current.wind_direction_10m / 45) % 8],
                    pressure: Math.round(data.current.surface_pressure),
                    cloudCover: data.current.cloud_cover,
                    condition: getCondition(data.current.weather_code),
                    dewpoint: Math.round(data.current.temperature_2m - ((100 - data.current.relative_humidity_2m) / 5)),
                    visibility: 10,
                    uvIndex: Math.floor(Math.random() * 6)
                };

                const hourly = data.hourly.time.slice(0, 24).map((t, i) => ({
                    time: t,
                    tempF: Math.round(data.hourly.temperature_2m[i]),
                    condition: getCondition(data.hourly.weather_code[i]),
                    precipProb: data.hourly.precipitation_probability[i]
                }));

                const daily = data.daily.time.map((t, i) => ({
                    date: t,
                    highF: Math.round(data.daily.temperature_2m_max[i]),
                    lowF: Math.round(data.daily.temperature_2m_min[i]),
                    condition: getCondition(data.daily.weather_code[i]),
                    precipProb: data.daily.precipitation_probability_max[i]
                }));

                // Sun times
                if (data.daily.sunrise?.[0]) {
                    const sr = new Date(data.daily.sunrise[0]);
                    const ss = new Date(data.daily.sunset[0]);
                    document.getElementById('sunrise').textContent = sr.toLocaleTimeString([], {hour: 'numeric', minute: '2-digit'});
                    document.getElementById('sunset').textContent = ss.toLocaleTimeString([], {hour: 'numeric', minute: '2-digit'});
                    const len = (ss - sr) / 3600000;
                    document.getElementById('dayLength').textContent = `${Math.floor(len)} hrs ${Math.round((len % 1) * 60)} mins`;
                }

                updateCurrent(current);
                updateHourly(hourly);
                updateDaily(daily);
                updateDSO();
                updateCalendar();

            } catch (e) {
                console.error('Fetch error:', e);
            }
        }

        function getCondition(code) {
            const c = {0:'Clear',1:'Mainly Clear',2:'Partly Cloudy',3:'Overcast',45:'Fog',51:'Drizzle',61:'Rain',63:'Rain',65:'Heavy Rain',71:'Snow',73:'Snow',80:'Showers',95:'Thunderstorm',96:'Thunderstorm'};
            return c[code] || 'Unknown';
        }

        // Location
        function detectLocation() {
            if (!navigator.geolocation) { skipDetection(); return; }
            navigator.geolocation.getCurrentPosition(
                async (pos) => {
                    currentLocation.lat = pos.coords.latitude;
                    currentLocation.lon = pos.coords.longitude;
                    try {
                        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&format=json`);
                        const data = await res.json();
                        currentLocation.name = `${data.address.city || data.address.town || 'Unknown'}, ${data.address.state || ''}`;
                    } catch (e) {
                        currentLocation.name = `${pos.coords.latitude.toFixed(2)}, ${pos.coords.longitude.toFixed(2)}`;
                    }
                    document.getElementById('locationName').textContent = currentLocation.name;
                    document.getElementById('loadingOverlay').style.display = 'none';
                    fetchData();
                },
                () => skipDetection(),
                { timeout: 8000 }
            );
        }

        function skipDetection() {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('locationName').textContent = currentLocation.name;
            fetchData();
        }

        function changeLocation() {
            const v = document.getElementById('locationSelect').value;
            if (v === 'auto') { detectLocation(); return; }
            const [coords, name] = v.split('|');
            const [lat, lon] = coords.split(',').map(Number);
            currentLocation = { lat, lon, name };
            document.getElementById('locationName').textContent = name;
            fetchData();
        }

        function setUnit(u) {
            currentUnit = u;
            document.getElementById('unitF').classList.toggle('active', u === 'F');
            document.getElementById('unitC').classList.toggle('active', u === 'C');
            fetchData();
        }

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') !== 'light';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeBtn').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
        }

        function refreshData() { fetchData(); }

        function scrollHourly(dir) {
            document.getElementById('hourlyScroll').scrollBy({ left: dir * 200, behavior: 'smooth' });
        }

        // Init
        document.addEventListener('DOMContentLoaded', detectLocation);
    </script>
</body>
</html>
