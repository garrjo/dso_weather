<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSO Weather | Arkansas Daily Forecast</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-elevated: #1a1a24;
            --border: #2a2a3a;
            --text-primary: #f0f0f5;
            --text-secondary: #8888aa;
            --text-muted: #555566;
            --accent-red: #ef4444;
            --accent-orange: #f97316;
            --accent-yellow: #eab308;
            --accent-green: #22c55e;
            --accent-blue: #3b82f6;
            --accent-purple: #a855f7;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border);
        }
        .logo { display: flex; align-items: center; gap: 1rem; }
        .logo-icon {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-red));
            border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
        }
        .logo h1 { font-size: 1.5rem; font-weight: 700; }
        .logo span { color: var(--text-secondary); font-size: 0.875rem; }
        .controls { display: flex; gap: 1rem; align-items: center; }
        select, input[type="date"] {
            background: var(--bg-elevated); border: 1px solid var(--border);
            color: var(--text-primary); padding: 0.75rem 1rem; border-radius: 8px;
            font-family: inherit; font-size: 0.9rem; cursor: pointer;
        }
        select:focus, input:focus { outline: none; border-color: var(--accent-blue); }
        .main-grid { display: grid; grid-template-columns: 1fr 400px; gap: 2rem; }
        @media (max-width: 1100px) { .main-grid { grid-template-columns: 1fr; } }
        .today-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 16px; padding: 2rem;
        }
        .today-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem; }
        .today-date { font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .today-location { font-size: 1.5rem; font-weight: 600; }
        .risk-badge {
            padding: 0.5rem 1.25rem; border-radius: 100px; font-weight: 600;
            font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .prediction-main { display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem; }
        .storm-type { font-size: 3rem; font-weight: 700; letter-spacing: -1px; }
        .danger-gauge { flex: 1; max-width: 200px; }
        .gauge-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; }
        .gauge-bar { height: 12px; background: var(--bg-elevated); border-radius: 6px; overflow: hidden; }
        .gauge-fill { height: 100%; border-radius: 6px; transition: width 0.5s ease; }
        .gauge-value { font-family: 'JetBrains Mono', monospace; font-size: 1.25rem; font-weight: 600; margin-top: 0.5rem; }
        .mechanism {
            background: var(--bg-elevated); padding: 1rem 1.25rem; border-radius: 8px;
            font-size: 0.9rem; color: var(--text-secondary); border-left: 3px solid var(--accent-blue);
        }
        .factors-section { margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border); }
        .section-title { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1rem; }
        .factors-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        @media (max-width: 768px) { .factors-grid { grid-template-columns: repeat(2, 1fr); } }
        .factor-card { background: var(--bg-elevated); border-radius: 12px; padding: 1.25rem; }
        .factor-name { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem; }
        .factor-value { font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; font-weight: 600; }
        .factor-bar { height: 4px; background: var(--bg-dark); border-radius: 2px; margin-top: 0.75rem; overflow: hidden; }
        .factor-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }
        .indices-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem; }
        .index-card { background: var(--bg-elevated); border-radius: 12px; padding: 1rem 1.25rem; text-align: center; }
        .index-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .index-value { font-family: 'JetBrains Mono', monospace; font-size: 1.25rem; font-weight: 600; margin-top: 0.25rem; }
        .sidebar { display: flex; flex-direction: column; gap: 1.5rem; }
        .forecast-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; }
        .forecast-list { display: flex; flex-direction: column; gap: 0.75rem; }
        .forecast-day {
            display: flex; align-items: center; gap: 1rem; padding: 0.75rem;
            background: var(--bg-elevated); border-radius: 10px; cursor: pointer; transition: background 0.2s;
        }
        .forecast-day:hover { background: var(--bg-dark); }
        .forecast-day.active { border: 1px solid var(--accent-blue); }
        .forecast-date { width: 60px; }
        .forecast-weekday { font-weight: 600; font-size: 0.9rem; }
        .forecast-monthday { font-size: 0.75rem; color: var(--text-secondary); }
        .forecast-type { flex: 1; font-size: 0.85rem; font-weight: 500; }
        .forecast-danger { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; padding: 0.25rem 0.5rem; border-radius: 4px; background: var(--bg-dark); }
        .chart-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; }
        .catalyst-chart { height: 150px; position: relative; margin-top: 1rem; }
        .chart-svg { width: 100%; height: 100%; }
        .chart-line { fill: none; stroke: var(--accent-orange); stroke-width: 2; }
        .chart-marker { fill: var(--accent-red); }
        .chart-axis { stroke: var(--border); stroke-width: 1; }
        .chart-label { font-size: 10px; fill: var(--text-muted); }
        .inversion-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; }
        .inversion-display { display: flex; align-items: center; gap: 1rem; margin-top: 1rem; }
        .inversion-ratio { font-family: 'JetBrains Mono', monospace; font-size: 2rem; font-weight: 700; }
        .inversion-mode { font-size: 0.85rem; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; }
        .mode-vertical { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }
        .mode-horizontal { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }
        .mode-transitional { background: rgba(234, 179, 8, 0.2); color: var(--accent-yellow); }
        footer { margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border); text-align: center; color: var(--text-muted); font-size: 0.85rem; }
        footer a { color: var(--accent-blue); text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">⚡</div>
                <div>
                    <h1>DSO Weather</h1>
                    <span>E-Field Severe Weather Prediction</span>
                </div>
            </div>
            <div class="controls">
                <select id="regionSelect">
                    <option value="benton_ar">Benton, AR</option>
                    <option value="haskell_ar">Haskell, AR</option>
                    <option value="little_rock">Little Rock, AR</option>
                    <option value="tornado_alley">Tornado Alley (OK/KS)</option>
                    <option value="dixie_alley">Dixie Alley (MS/AL)</option>
                </select>
                <input type="date" id="dateSelect">
            </div>
        </header>

        <div class="main-grid">
            <div class="main-content">
                <div class="today-card">
                    <div class="today-header">
                        <div>
                            <div class="today-date" id="todayDate">Loading...</div>
                            <div class="today-location" id="todayLocation">--</div>
                        </div>
                        <div class="risk-badge" id="riskBadge">--</div>
                    </div>
                    <div class="prediction-main">
                        <div class="storm-type" id="stormType">--</div>
                        <div class="danger-gauge">
                            <div class="gauge-label">Danger Index</div>
                            <div class="gauge-bar"><div class="gauge-fill" id="dangerFill"></div></div>
                            <div class="gauge-value" id="dangerValue">--</div>
                        </div>
                    </div>
                    <div class="mechanism" id="mechanism">Loading prediction...</div>
                    <div class="factors-section">
                        <div class="section-title">DSO Factors</div>
                        <div class="factors-grid">
                            <div class="factor-card">
                                <div class="factor-name">Catalyst (dθ/dt)</div>
                                <div class="factor-value" id="factorCatalyst">--</div>
                                <div class="factor-bar"><div class="factor-fill" id="catalystBar" style="background: var(--accent-orange);"></div></div>
                            </div>
                            <div class="factor-card">
                                <div class="factor-name">Solar Angle</div>
                                <div class="factor-value" id="factorSolar">--</div>
                                <div class="factor-bar"><div class="factor-fill" id="solarBar" style="background: var(--accent-yellow);"></div></div>
                            </div>
                            <div class="factor-card">
                                <div class="factor-name">E-Fuel</div>
                                <div class="factor-value" id="factorFuel">--</div>
                                <div class="factor-bar"><div class="factor-fill" id="fuelBar" style="background: var(--accent-red);"></div></div>
                            </div>
                            <div class="factor-card">
                                <div class="factor-name">E-Gradient</div>
                                <div class="factor-value" id="factorGradient">--</div>
                                <div class="factor-bar"><div class="factor-fill" id="gradientBar" style="background: var(--accent-purple);"></div></div>
                            </div>
                        </div>
                        <div class="indices-row">
                            <div class="index-card">
                                <div class="index-label">Probability</div>
                                <div class="index-value" id="indexProb">--</div>
                            </div>
                            <div class="index-card">
                                <div class="index-label">Volatility</div>
                                <div class="index-value" id="indexVol">--</div>
                            </div>
                            <div class="index-card">
                                <div class="index-label">Gulf SST</div>
                                <div class="index-value" id="indexSST">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar">
                <div class="forecast-card">
                    <div class="section-title">7-Day Forecast</div>
                    <div class="forecast-list" id="forecastList"></div>
                </div>
                <div class="inversion-card">
                    <div class="section-title">Discharge Mode</div>
                    <div class="inversion-display">
                        <div class="inversion-ratio" id="inversionRatio">--</div>
                        <div class="inversion-mode" id="inversionMode">--</div>
                    </div>
                    <div style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">
                        &gt; 1.2 = Horizontal (bomb cyclone)<br>
                        &lt; 1.0 = Vertical (convective)
                    </div>
                </div>
                <div class="chart-card">
                    <div class="section-title">Catalyst Curve (Annual)</div>
                    <div class="catalyst-chart">
                        <svg class="chart-svg" id="catalystSvg" viewBox="0 0 350 140"></svg>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p>DSO Weather Model v1.0 | <a href="https://doi.org/10.5281/zenodo.18193711" target="_blank">Zenodo Publication</a> | © 2026 Joe Garrett / VaultSync Solutions Inc.</p>
            <p style="margin-top: 0.5rem;">Drag-Scale-Object E-Field Framework | "Weather is E-geometry, not chaos."</p>
        </footer>
    </div>

    <script>
    // DSO Weather Engine - Embedded for standalone operation
    class DSOWeatherEngine {
        constructor() {
            this.regions = {
                'benton_ar': { name: 'Benton, AR', lat: 34.5645, lon: -92.5868, gulfDistance: 650, elevation: 127, gradientZone: 0.85 },
                'little_rock': { name: 'Little Rock, AR', lat: 34.7465, lon: -92.2896, gulfDistance: 680, elevation: 102, gradientZone: 0.82 },
                'haskell_ar': { name: 'Haskell, AR', lat: 34.5012, lon: -92.6368, gulfDistance: 645, elevation: 91, gradientZone: 0.86 },
                'tornado_alley': { name: 'Tornado Alley (OK/KS)', lat: 35.5, lon: -98.0, gulfDistance: 800, elevation: 400, gradientZone: 1.00 },
                'dixie_alley': { name: 'Dixie Alley (MS/AL)', lat: 33.0, lon: -88.0, gulfDistance: 350, elevation: 150, gradientZone: 0.75 }
            };
            this.gulfSSTBaseline = 26.5;
            this.climateOffset = 0;
        }
        getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            return Math.floor((date - start) / (1000 * 60 * 60 * 24));
        }
        getCatalyst(dayOfYear) {
            const phase = (2 * Math.PI * (dayOfYear - 80)) / 365.25;
            const rawValue = 23.5 * (2 * Math.PI / 365.25) * Math.cos(phase);
            return Math.abs(rawValue) / 0.405;
        }
        getSolarDeclination(dayOfYear) {
            return 23.45 * Math.sin((2 * Math.PI / 365.25) * (dayOfYear - 81));
        }
        getSolarAngle(dayOfYear, latitude) {
            const declination = this.getSolarDeclination(dayOfYear);
            const decRad = declination * Math.PI / 180;
            const latRad = latitude * Math.PI / 180;
            const sinAlpha = Math.sin(latRad) * Math.sin(decRad) + Math.cos(latRad) * Math.cos(decRad);
            return Math.max(0, Math.min(1, sinAlpha));
        }
        getGulfSST(dayOfYear) {
            const seasonalOffset = 3 * Math.sin((2 * Math.PI * (dayOfYear - 45)) / 365.25);
            return this.gulfSSTBaseline + seasonalOffset + this.climateOffset;
        }
        getFuel(dayOfYear, gulfDistance) {
            const sst = this.getGulfSST(dayOfYear);
            const sstNorm = (sst - 20) / 12;
            const distanceDecay = Math.exp(-gulfDistance / 1500);
            return Math.max(0, Math.min(1, sstNorm * distanceDecay * 1.5));
        }
        getGradient(dayOfYear, gradientZone) {
            const springPeak = Math.exp(-Math.pow((dayOfYear - 100) / 45, 2));
            const fallPeak = Math.exp(-Math.pow((dayOfYear - 290) / 50, 2)) * 0.7;
            return Math.max(springPeak, fallPeak) * gradientZone;
        }
        getInversionRatio(catalyst, solarAngle) { return catalyst / (solarAngle + 0.1); }
        getDischargeMode(inversionRatio) {
            if (inversionRatio > 1.2) return 'HORIZONTAL';
            if (inversionRatio > 1.0) return 'TRANSITIONAL';
            return 'VERTICAL';
        }
        getProbability(fuel, catalyst, solarAngle) { return fuel * catalyst * solarAngle; }
        getVolatility(gradient, catalyst, solarAngle) { return gradient * catalyst * solarAngle; }
        getDangerIndex(fuel, gradient, catalyst, solarAngle) {
            return fuel * gradient * Math.pow(catalyst, 2) * Math.pow(solarAngle, 2);
        }
        classifyStorm(fuel, gradient, catalyst, solarAngle, inversionRatio) {
            const volatility = this.getVolatility(gradient, catalyst, solarAngle);
            const danger = this.getDangerIndex(fuel, gradient, catalyst, solarAngle);
            if (inversionRatio > 1.2) {
                return fuel > 0.5 ? { type: 'BOMB_CYCLONE', severity: 'HIGH', color: '#9333ea' }
                                  : { type: 'WINTER_STORM', severity: 'MODERATE', color: '#3b82f6' };
            }
            if (gradient > 0.6 && catalyst > 0.5 && volatility > 0.35) {
                if (danger > 0.15) return { type: 'TORNADO', severity: 'EXTREME', color: '#dc2626' };
                if (danger > 0.08) return { type: 'TORNADO', severity: 'HIGH', color: '#ea580c' };
                return { type: 'SUPERCELL', severity: 'MODERATE', color: '#f59e0b' };
            }
            if (fuel > 0.7 && catalyst < 0.3) return { type: 'DERECHO', severity: 'MODERATE', color: '#0891b2' };
            if (fuel > 0.4 && solarAngle > 0.5) {
                return volatility > 0.2 ? { type: 'SEVERE_TSTORM', severity: 'MODERATE', color: '#eab308' }
                                        : { type: 'THUNDERSTORM', severity: 'LOW', color: '#22c55e' };
            }
            if (fuel < 0.3 || catalyst < 0.2) return { type: 'FAIR', severity: 'MINIMAL', color: '#6b7280' };
            return { type: 'UNSETTLED', severity: 'LOW', color: '#a3a3a3' };
        }
        getRiskLevel(danger) {
            if (danger > 0.15) return { level: 5, label: 'EXTREME', color: '#dc2626' };
            if (danger > 0.08) return { level: 4, label: 'HIGH', color: '#ea580c' };
            if (danger > 0.04) return { level: 3, label: 'MODERATE', color: '#f59e0b' };
            if (danger > 0.02) return { level: 2, label: 'LOW', color: '#22c55e' };
            return { level: 1, label: 'MINIMAL', color: '#6b7280' };
        }
        getMechanismExplanation(type, fuel, gradient, catalyst) {
            const explanations = {
                'TORNADO': `High gradient (${(gradient*100).toFixed(0)}%) + high catalyst (${(catalyst*100).toFixed(0)}%) → maximum rotational potential`,
                'SUPERCELL': 'Organized rotation likely with sustained updraft',
                'SEVERE_TSTORM': 'Sufficient fuel and instability for severe development',
                'THUNDERSTORM': 'Standard convective activity expected',
                'DERECHO': `High fuel (${(fuel*100).toFixed(0)}%) + low catalyst → linear wind damage pattern`,
                'BOMB_CYCLONE': 'Inversion mode: catalyst dominates solar → horizontal discharge',
                'WINTER_STORM': 'Low solar input + high catalyst → organized winter system',
                'FAIR': 'Insufficient energy/trigger combination',
                'UNSETTLED': 'Mixed signals - monitor for changes'
            };
            return explanations[type] || 'Standard atmospheric conditions';
        }
        predict(regionId, date) {
            const region = this.regions[regionId];
            if (!region) throw new Error(`Unknown region: ${regionId}`);
            const dayOfYear = this.getDayOfYear(date);
            const catalyst = this.getCatalyst(dayOfYear);
            const solarAngle = this.getSolarAngle(dayOfYear, region.lat);
            const fuel = this.getFuel(dayOfYear, region.gulfDistance);
            const gradient = this.getGradient(dayOfYear, region.gradientZone);
            const inversionRatio = this.getInversionRatio(catalyst, solarAngle);
            const dischargeMode = this.getDischargeMode(inversionRatio);
            const probability = this.getProbability(fuel, catalyst, solarAngle);
            const volatility = this.getVolatility(gradient, catalyst, solarAngle);
            const danger = this.getDangerIndex(fuel, gradient, catalyst, solarAngle);
            const classification = this.classifyStorm(fuel, gradient, catalyst, solarAngle, inversionRatio);
            return {
                region: region.name, date: date.toISOString().split('T')[0], dayOfYear,
                factors: { catalyst, solarAngle, fuel, gradient, inversionRatio, dischargeMode, gulfSST: this.getGulfSST(dayOfYear) },
                indices: { probability, volatility, danger },
                prediction: classification,
                riskLevel: this.getRiskLevel(danger),
                mechanism: this.getMechanismExplanation(classification.type, fuel, gradient, catalyst)
            };
        }
        forecast(regionId, startDate, days = 7) {
            const forecasts = [];
            const date = new Date(startDate);
            for (let i = 0; i < days; i++) {
                forecasts.push(this.predict(regionId, new Date(date)));
                date.setDate(date.getDate() + 1);
            }
            return forecasts;
        }
    }

    // UI Controller
    const engine = new DSOWeatherEngine();
    let currentRegion = 'benton_ar';
    let currentDate = new Date();
    document.getElementById('dateSelect').valueAsDate = currentDate;

    function updatePrediction() {
        const p = engine.predict(currentRegion, currentDate);
        document.getElementById('todayDate').textContent = currentDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('todayLocation').textContent = p.region;
        const riskBadge = document.getElementById('riskBadge');
        riskBadge.textContent = p.riskLevel.label;
        riskBadge.style.background = p.riskLevel.color;
        riskBadge.style.color = p.riskLevel.level > 2 ? '#fff' : '#000';
        const stormType = document.getElementById('stormType');
        stormType.textContent = p.prediction.type.replace('_', ' ');
        stormType.style.color = p.prediction.color;
        const dangerPercent = Math.min(100, p.indices.danger * 500);
        document.getElementById('dangerFill').style.width = dangerPercent + '%';
        document.getElementById('dangerFill').style.background = p.riskLevel.color;
        document.getElementById('dangerValue').textContent = p.indices.danger.toFixed(4);
        document.getElementById('mechanism').textContent = p.mechanism;
        document.getElementById('factorCatalyst').textContent = (p.factors.catalyst * 100).toFixed(1) + '%';
        document.getElementById('catalystBar').style.width = (p.factors.catalyst * 100) + '%';
        document.getElementById('factorSolar').textContent = (p.factors.solarAngle * 100).toFixed(1) + '%';
        document.getElementById('solarBar').style.width = (p.factors.solarAngle * 100) + '%';
        document.getElementById('factorFuel').textContent = (p.factors.fuel * 100).toFixed(1) + '%';
        document.getElementById('fuelBar').style.width = (p.factors.fuel * 100) + '%';
        document.getElementById('factorGradient').textContent = (p.factors.gradient * 100).toFixed(1) + '%';
        document.getElementById('gradientBar').style.width = (p.factors.gradient * 100) + '%';
        document.getElementById('indexProb').textContent = (p.indices.probability * 100).toFixed(2) + '%';
        document.getElementById('indexVol').textContent = (p.indices.volatility * 100).toFixed(2) + '%';
        document.getElementById('indexSST').textContent = p.factors.gulfSST.toFixed(1) + '°C';
        document.getElementById('inversionRatio').textContent = p.factors.inversionRatio.toFixed(2);
        const inversionMode = document.getElementById('inversionMode');
        inversionMode.textContent = p.factors.dischargeMode;
        inversionMode.className = 'inversion-mode mode-' + p.factors.dischargeMode.toLowerCase();
        updateForecast();
        updateCatalystChart(p.dayOfYear);
    }

    function updateForecast() {
        const forecasts = engine.forecast(currentRegion, currentDate, 7);
        const list = document.getElementById('forecastList');
        list.innerHTML = '';
        forecasts.forEach((f, i) => {
            const div = document.createElement('div');
            div.className = 'forecast-day' + (i === 0 ? ' active' : '');
            div.onclick = () => { currentDate = new Date(f.date + 'T12:00:00'); document.getElementById('dateSelect').valueAsDate = currentDate; updatePrediction(); };
            const d = new Date(f.date);
            div.innerHTML = `
                <div class="forecast-date">
                    <div class="forecast-weekday">${i === 0 ? 'Today' : d.toLocaleDateString('en-US', { weekday: 'short' })}</div>
                    <div class="forecast-monthday">${d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                </div>
                <div class="forecast-type" style="color: ${f.prediction.color}">${f.prediction.type.replace('_', ' ')}</div>
                <div class="forecast-danger" style="color: ${f.riskLevel.color}">${f.indices.danger.toFixed(3)}</div>
            `;
            list.appendChild(div);
        });
    }

    function updateCatalystChart(currentDoy) {
        const svg = document.getElementById('catalystSvg');
        const width = 350, height = 140;
        const padding = { top: 10, right: 10, bottom: 25, left: 30 };
        const chartWidth = width - padding.left - padding.right;
        const chartHeight = height - padding.top - padding.bottom;
        let pathData = '';
        for (let day = 1; day <= 365; day++) {
            const catalyst = engine.getCatalyst(day);
            const x = padding.left + (day / 365) * chartWidth;
            const y = padding.top + chartHeight - (catalyst * chartHeight);
            pathData += (day === 1 ? 'M' : 'L') + x.toFixed(1) + ',' + y.toFixed(1);
        }
        const currentX = padding.left + (currentDoy / 365) * chartWidth;
        const currentY = padding.top + chartHeight - (engine.getCatalyst(currentDoy) * chartHeight);
        svg.innerHTML = `
            <line x1="${padding.left}" y1="${padding.top}" x2="${padding.left}" y2="${height - padding.bottom}" class="chart-axis"/>
            <line x1="${padding.left}" y1="${height - padding.bottom}" x2="${width - padding.right}" y2="${height - padding.bottom}" class="chart-axis"/>
            <text x="${padding.left + chartWidth * 0.08}" y="${height - 8}" class="chart-label">Mar</text>
            <text x="${padding.left + chartWidth * 0.25}" y="${height - 8}" class="chart-label">May</text>
            <text x="${padding.left + chartWidth * 0.42}" y="${height - 8}" class="chart-label">Jul</text>
            <text x="${padding.left + chartWidth * 0.58}" y="${height - 8}" class="chart-label">Sep</text>
            <text x="${padding.left + chartWidth * 0.75}" y="${height - 8}" class="chart-label">Nov</text>
            <line x1="${padding.left + (80/365) * chartWidth}" y1="${padding.top}" x2="${padding.left + (80/365) * chartWidth}" y2="${height - padding.bottom}" stroke="#3b82f6" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
            <line x1="${padding.left + (266/365) * chartWidth}" y1="${padding.top}" x2="${padding.left + (266/365) * chartWidth}" y2="${height - padding.bottom}" stroke="#3b82f6" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
            <path d="${pathData}" class="chart-line"/>
            <circle cx="${currentX}" cy="${currentY}" r="6" class="chart-marker"/>
            <circle cx="${currentX}" cy="${currentY}" r="10" fill="none" stroke="#ef4444" stroke-width="2" opacity="0.5"/>
        `;
    }

    document.getElementById('regionSelect').addEventListener('change', (e) => { currentRegion = e.target.value; updatePrediction(); });
    document.getElementById('dateSelect').addEventListener('change', (e) => { currentDate = new Date(e.target.value + 'T12:00:00'); updatePrediction(); });
    updatePrediction();
    </script>
</body>
</html>
